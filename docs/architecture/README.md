# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

DOMãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ è¨­è¨ˆæ–¹é‡

### ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹è¨­è¨ˆã®ç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³                â”‚
â”‚         (UI + ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° + ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Toolbar    â”‚  â”‚   Canvas    â”‚  â”‚ Panel   â”‚  â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ API Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DOM Whiteboard Library                â”‚
â”‚              (ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Engine  â”‚  Tools  â”‚  State  â”‚  Events â”‚ Utils  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŸå‰‡:**
- **åˆ†é›¢**: UIã¨ãƒ­ã‚¸ãƒƒã‚¯ã®å®Œå…¨ãªåˆ†é›¢
- **æ‹¡å¼µæ€§**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å¯èƒ½ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: DOM + CSS Transformã«ã‚ˆã‚‹é«˜é€Ÿæç”»
- **å‹å®‰å…¨æ€§**: TypeScriptã«ã‚ˆã‚‹å …ç‰¢ãªå‹ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ›ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                API Layer                        â”‚
â”‚  WhiteboardEngine | ToolManager | EventEmitter â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               Service Layer                     â”‚
â”‚   StateManager | ShapeService | CameraService  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               Core Layer                        â”‚
â”‚     Shape System | Coordinate System | Tools   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Rendering Layer                    â”‚
â”‚      DOM Renderer | CSS Transform Engine       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Platform Layer                     â”‚
â”‚     Event System | Browser APIs | Utilities    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 1. WhiteboardEngine (ä¸­å¤®ã‚¨ãƒ³ã‚¸ãƒ³)

```typescript
class WhiteboardEngine {
  private stateManager: StateManager;
  private shapeService: ShapeService;
  private toolManager: ToolManager;
  private renderer: DOMRenderer;
  private eventEmitter: EventEmitter;
  private cameraService: CameraService;
  
  constructor(options: WhiteboardEngineOptions) {
    this.initializeServices();
    this.setupEventHandlers();
    this.bindDOMEvents();
  }
}
```

**è²¬å‹™:**
- ã‚µãƒ¼ãƒ“ã‚¹é–“ã®èª¿æ•´ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
- å¤–éƒ¨APIã®æä¾›
- ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ç¶™ã¨ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ

### 2. StateManager (çŠ¶æ…‹ç®¡ç†)

```typescript
class StateManager {
  private store: WhiteboardStore;
  private subscribers: Map<string, Function[]>;
  
  // Zustandé¢¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªçŠ¶æ…‹ç®¡ç†
  getState(): WhiteboardState;
  setState(partial: Partial<WhiteboardState>): void;
  subscribe(selector: Function, callback: Function): void;
  
  // æœ€é©åŒ–ã•ã‚ŒãŸæ›´æ–°
  updateShapes(updates: ShapeUpdate[]): void;
  batchUpdates(fn: () => void): void;
}
```

**ç‰¹å¾´:**
- **ä¸å¤‰æ€§**: Immerã‚’ä½¿ç”¨ã—ãŸã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«æ›´æ–°
- **é¸æŠçš„è³¼èª­**: å¿…è¦ãªéƒ¨åˆ†ã®ã¿ã®å†æç”»
- **ãƒãƒƒãƒæ›´æ–°**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 3. Shape System (ã‚·ã‚§ã‚¤ãƒ—ã‚·ã‚¹ãƒ†ãƒ )

```typescript
// Shape Factory Pattern
class ShapeFactory {
  static create(options: CreateShapeOptions): Shape {
    switch (options.type) {
      case 'rectangle': return new RectangleShape(options);
      case 'ellipse': return new EllipseShape(options);
      case 'line': return new LineShape(options);
      case 'text': return new TextShape(options);
      case 'freehand': return new FreehandShape(options);
    }
  }
}

// Shape Base Class
abstract class BaseShape implements Shape {
  abstract render(renderer: DOMRenderer): HTMLElement;
  abstract getBounds(): Rectangle;
  abstract hitTest(point: Point): boolean;
  abstract transform(matrix: TransformMatrix): void;
  
  // å…±é€šæ©Ÿèƒ½
  clone(): Shape { /* ... */ }
  serialize(): ShapeData { /* ... */ }
  deserialize(data: ShapeData): void { /* ... */ }
}
```

**è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³:**
- **Factory Pattern**: Shapeä½œæˆã®çµ±ä¸€åŒ–
- **Strategy Pattern**: æç”»ãƒ»å½“ãŸã‚Šåˆ¤å®šã®å¤šæ…‹æ€§
- **Prototype Pattern**: Shapeã®ã‚¯ãƒ­ãƒ¼ãƒ³æ©Ÿèƒ½

### 4. Tool System (ãƒ„ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ )

```typescript
// Tool State Machine
class ToolStateMachine {
  private currentState: ToolState;
  private stateHandlers: Map<string, ToolStateHandler>;
  
  transition(event: ToolEvent): void {
    const handler = this.stateHandlers.get(this.currentState);
    const nextState = handler.handle(event);
    if (nextState !== this.currentState) {
      this.currentState = nextState;
      this.emit('state:changed', { from: this.currentState, to: nextState });
    }
  }
}

// Rectangle Tool Example
class RectangleTool extends BaseTool {
  private states = {
    idle: new IdleState(),
    drawing: new DrawingState(),
    complete: new CompleteState(),
  };
  
  onPointerDown(event: PointerEvent) {
    this.stateMachine.transition({
      type: 'pointer:down',
      point: this.engine.screenToWorld(event),
    });
  }
}
```

**ç‰¹å¾´:**
- **ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³**: è¤‡é›‘ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®ç®¡ç†
- **ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³**: Undo/Redoå¯¾å¿œ
- **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½**: ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ 

### 5. DOM Renderer (æç”»ã‚¨ãƒ³ã‚¸ãƒ³)

```typescript
class DOMRenderer {
  private container: HTMLElement;
  private shapeElements: Map<string, HTMLElement>;
  private transformCache: Map<string, string>;
  
  render(shapes: Shape[], camera: Camera): void {
    // ä»®æƒ³åŒ–: å¯è¦–ç¯„å›²ã®ã¿æç”»
    const visibleShapes = this.cullShapes(shapes, camera);
    
    // ãƒãƒƒãƒæ›´æ–°ã§ãƒªãƒ•ãƒ­ãƒ¼æœ€å°åŒ–
    this.batchUpdates(() => {
      visibleShapes.forEach(shape => {
        this.updateShapeElement(shape, camera);
      });
    });
  }
  
  updateShapeElement(shape: Shape, camera: Camera): void {
    const element = this.getOrCreateElement(shape);
    const transform = this.calculateTransform(shape, camera);
    
    // CSS Transformä½¿ç”¨ã§é«˜é€Ÿæç”»
    if (this.transformCache.get(shape.id) !== transform) {
      element.style.transform = transform;
      this.transformCache.set(shape.id, transform);
    }
  }
}
```

**æœ€é©åŒ–æŠ€è¡“:**
- **ä»®æƒ³åŒ–**: å¤§é‡Shapeå‡¦ç†
- **CSS Transform**: GPUåŠ é€Ÿæ´»ç”¨
- **ãƒãƒƒãƒæ›´æ–°**: ãƒªãƒ•ãƒ­ãƒ¼/ãƒªãƒšã‚¤ãƒ³ãƒˆæœ€å°åŒ–
- **å¤‰æ›´æ¤œå‡º**: ä¸è¦ãªæ›´æ–°ã®å›é¿

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### å˜æ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
User Interaction
       â†“
   Event Handler
       â†“
   Tool Processing
       â†“
   State Update
       â†“
   View Update
```

### è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¾‹

```typescript
// 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
canvas.addEventListener('pointerdown', (e) => {
  
  // 2. ã‚¤ãƒ™ãƒ³ãƒˆæ­£è¦åŒ–
  const event = normalizePointerEvent(e);
  
  // 3. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«ã«å§”è­²
  const tool = this.toolManager.getActiveTool();
  tool.onPointerDown(event, this.engine);
  
  // 4. ãƒ„ãƒ¼ãƒ«å†…ã§ã®Stateæ›´æ–°
  this.engine.setState({
    selectedShapeIds: [shapeId],
    tool: { mode: 'dragging', startPoint: point }
  });
  
  // 5. Stateå¤‰æ›´ã®æ¤œçŸ¥ã¨ä¼æ’­
  this.stateManager.notify('selection:changed');
  
  // 6. Viewæ›´æ–°
  this.renderer.updateSelection();
});
```

## ğŸ¨ åº§æ¨™ç³»ã¨ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ 

### åº§æ¨™ç³»ã®éšå±¤

```
World Space (ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™)
    â†“ Camera Transform
Screen Space (ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åº§æ¨™)  
    â†“ DOM Transform
Element Space (è¦ç´ åº§æ¨™)
```

### åº§æ¨™å¤‰æ›ã®å®Ÿè£…

```typescript
class CoordinateSystem {
  worldToScreen(point: Point, camera: Camera, viewport: Viewport): Point {
    return {
      x: (point.x - camera.x) * camera.zoom + viewport.width / 2,
      y: (point.y - camera.y) * camera.zoom + viewport.height / 2,
    };
  }
  
  screenToWorld(point: Point, camera: Camera, viewport: Viewport): Point {
    return {
      x: (point.x - viewport.width / 2) / camera.zoom + camera.x,
      y: (point.y - viewport.height / 2) / camera.zoom + camera.y,
    };
  }
  
  // ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å¤‰æ›ã«ã‚ˆã‚‹é«˜é€Ÿè¨ˆç®—
  createTransformMatrix(shape: Shape, camera: Camera): TransformMatrix {
    const screenPos = this.worldToScreen(shape, camera);
    return new TransformMatrix()
      .translate(screenPos.x, screenPos.y)
      .rotate(shape.rotation)
      .scale(camera.zoom, camera.zoom);
  }
}
```

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. æç”»æœ€é©åŒ–

```typescript
class PerformanceOptimizer {
  // ä»®æƒ³åŒ–: å¯è¦–ç¯„å›²å¤–ã®è¦ç´ ã‚’éè¡¨ç¤º
  cullShapes(shapes: Shape[], viewport: Rectangle): Shape[] {
    return shapes.filter(shape => 
      this.intersects(shape.bounds, viewport)
    );
  }
  
  // LOD (Level of Detail): ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè©³ç´°åº¦
  getLOD(shape: Shape, zoom: number): DetailLevel {
    if (zoom < 0.1) return 'minimal';
    if (zoom < 0.5) return 'low';
    if (zoom < 2.0) return 'medium';
    return 'high';
  }
  
  // ãƒãƒƒãƒæ›´æ–°: DOMæ“ä½œã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œ
  batchUpdates(updates: () => void): void {
    this.isUpdating = true;
    updates();
    this.isUpdating = false;
    this.flushUpdates();
  }
}
```

### 2. ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–

```typescript
class MemoryManager {
  private shapePool: Map<ShapeType, Shape[]>;
  private elementPool: HTMLElement[];
  
  // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«: Shapeä½œæˆã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›
  getShape(type: ShapeType): Shape {
    const pool = this.shapePool.get(type);
    return pool.length > 0 ? pool.pop()! : this.createShape(type);
  }
  
  releaseShape(shape: Shape): void {
    shape.reset();
    this.shapePool.get(shape.type).push(shape);
  }
  
  // WeakRefä½¿ç”¨ã§ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢
  private elementRefs = new WeakMap<Shape, HTMLElement>();
}
```

### 3. éåŒæœŸå‡¦ç†

```typescript
class AsyncProcessor {
  // Web Workerã§ã®é‡ã„è¨ˆç®—å‡¦ç†
  async calculateBounds(shapes: Shape[]): Promise<Rectangle[]> {
    return new Promise((resolve) => {
      this.worker.postMessage({ type: 'calculate-bounds', shapes });
      this.worker.onmessage = (e) => resolve(e.data.bounds);
    });
  }
  
  // RequestAnimationFrameã§ã®ã‚¹ãƒ ãƒ¼ã‚ºãªæ›´æ–°
  scheduleUpdate(fn: () => void): void {
    if (!this.pendingUpdate) {
      this.pendingUpdate = requestAnimationFrame(() => {
        fn();
        this.pendingUpdate = null;
      });
    }
  }
}
```

## ğŸ”Œ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

```typescript
interface Plugin {
  name: string;
  version: string;
  dependencies?: string[];
  
  install(engine: WhiteboardEngine): void;
  uninstall(engine: WhiteboardEngine): void;
}

class PluginManager {
  private plugins = new Map<string, Plugin>();
  private hooks = new Map<string, Function[]>();
  
  register(plugin: Plugin): void {
    this.validateDependencies(plugin);
    plugin.install(this.engine);
    this.plugins.set(plugin.name, plugin);
  }
  
  // Hook ã‚·ã‚¹ãƒ†ãƒ 
  addHook(name: string, fn: Function): void {
    if (!this.hooks.has(name)) {
      this.hooks.set(name, []);
    }
    this.hooks.get(name)!.push(fn);
  }
  
  runHooks(name: string, ...args: any[]): void {
    const hooks = this.hooks.get(name) || [];
    hooks.forEach(hook => hook(...args));
  }
}
```

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¾‹

```typescript
// ã‚°ãƒªãƒƒãƒ‰ã‚¹ãƒŠãƒƒãƒ—æ©Ÿèƒ½ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
class GridSnapPlugin implements Plugin {
  name = 'grid-snap';
  version = '1.0.0';
  
  install(engine: WhiteboardEngine): void {
    // Shapeç§»å‹•æ™‚ã«ã‚¹ãƒŠãƒƒãƒ—å‡¦ç†ã‚’è¿½åŠ 
    engine.pluginManager.addHook('shape:beforeMove', (shape, newPosition) => {
      if (engine.getState().snapToGrid) {
        const gridSize = engine.getState().gridSize;
        return {
          x: Math.round(newPosition.x / gridSize) * gridSize,
          y: Math.round(newPosition.y / gridSize) * gridSize,
        };
      }
      return newPosition;
    });
  }
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           E2E Tests             â”‚  â† Cypress/Playwright
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Integration Tests         â”‚  â† Testing Library  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Unit Tests             â”‚  â† Vitest/Jest
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ã‚¹ãƒˆã®åˆ†é¡

```typescript
// Unit Tests: å€‹åˆ¥ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ
describe('ShapeFactory', () => {
  it('should create rectangle shape', () => {
    const shape = ShapeFactory.create({
      type: 'rectangle',
      x: 0, y: 0,
      width: 100, height: 50
    });
    expect(shape.type).toBe('rectangle');
    expect(shape.getBounds()).toEqual({ x: 0, y: 0, width: 100, height: 50 });
  });
});

// Integration Tests: ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã®ãƒ†ã‚¹ãƒˆ  
describe('Engine Integration', () => {
  it('should update view when shape is added', () => {
    const engine = new WhiteboardEngine({ container });
    const shape = engine.addShape({ type: 'rectangle', x: 0, y: 0 });
    
    expect(container.querySelector(`[data-shape-id="${shape.id}"]`)).toBeTruthy();
  });
});

// E2E Tests: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªã®ãƒ†ã‚¹ãƒˆ
describe('Drawing Rectangle', () => {
  it('should create rectangle by drag', () => {
    cy.visit('/whiteboard');
    cy.get('[data-tool="rectangle"]').click();
    cy.get('[data-testid="canvas"]')
      .trigger('pointerdown', { clientX: 100, clientY: 100 })
      .trigger('pointermove', { clientX: 200, clientY: 150 })
      .trigger('pointerup');
    
    cy.get('[data-shape-type="rectangle"]').should('exist');
  });
});
```

## ğŸ“Š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨è¨ºæ–­

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬

```typescript
class PerformanceMonitor {
  private metrics = new Map<string, PerformanceEntry[]>();
  
  measure(name: string, fn: () => void): void {
    const start = performance.now();
    fn();
    const end = performance.now();
    
    this.recordMetric(name, end - start);
  }
  
  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è¨ˆæ¸¬
  measureRender(): void {
    const observer = new PerformanceObserver((list) => {
      for (const entry of list.getEntries()) {
        if (entry.name === 'render') {
          this.recordMetric('render-time', entry.duration);
        }
      }
    });
    observer.observe({ entryTypes: ['mark', 'measure'] });
  }
}
```

### ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½

```typescript
class DebugManager {
  private enabled = false;
  
  enable(): void {
    this.enabled = true;
    this.addDebugOverlay();
    this.enableEventLogging();
  }
  
  private addDebugOverlay(): void {
    // Shapeå¢ƒç•Œã®è¡¨ç¤º
    // é¸æŠãƒãƒ³ãƒ‰ãƒ«ã®è¡¨ç¤º
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±ã®è¡¨ç¤º
  }
  
  logEvent(event: WhiteboardEvent): void {
    if (this.enabled) {
      console.group(`Event: ${event.type}`);
      console.log('Data:', event.data);
      console.log('Timestamp:', event.timestamp);
      console.groupEnd();
    }
  }
}
```

## ğŸ”® å°†æ¥ã®æ‹¡å¼µæ€§

### è¨ˆç”»ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½

1. **å…±åŒç·¨é›†**: CRDT (Conflict-free Replicated Data Types) ã«ã‚ˆã‚‹åŒæœŸ
2. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ **: Shapeã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã¨éšå±¤ç®¡ç†
3. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: CSS/Web Animationsã«ã‚ˆã‚‹ã‚¹ãƒ ãƒ¼ã‚ºãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
4. **SVGã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ã§ã®å‡ºåŠ›æ©Ÿèƒ½
5. **ç”»åƒå–ã‚Šè¾¼ã¿**: ç”»åƒShape + OCRæ©Ÿèƒ½

### æŠ€è¡“çš„èª²é¡Œã¸ã®å¯¾å¿œ

- **å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿**: ä»®æƒ³åŒ– + ãƒšãƒ¼ã‚¸ãƒ³ã‚°
- **è¤‡é›‘ãªShape**: WebGL/Canvas2Dã¨ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**: WebRTC + WebSocket
- **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ**: ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆæœ€é©åŒ–

---

ğŸ“– **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
- [APIä»•æ§˜æ›¸](../api/) - è©³ç´°ãªAPI ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- [é–‹ç™ºã‚¬ã‚¤ãƒ‰](../development/) - å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰](./performance.md) - æœ€é©åŒ–ã®è©³ç´°
- [åº§æ¨™å¤‰æ›æˆ¦ç•¥](./coordinate-conversion-strategy.md) - åº§æ¨™å¤‰æ›ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¨­è¨ˆåˆ¤æ–­