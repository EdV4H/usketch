# React版への完全移行計画書

## 概要

本計画書は、uSketchプロジェクトにおいてVanilla JavaScript版のサポートを終了し、React版に完全移行するための詳細な計画を記述します。

## 移行の背景と目的

### 背景
- 現在、Vanilla JS版とReact版の2つの実装を並行してメンテナンスしている
- 両バージョンの機能パリティを保つための開発コストが高い
- ほとんどのモダンなWebアプリケーションがReactなどのフレームワークを使用している

### 目的
1. **開発効率の向上**: 単一の実装に集中することで開発速度を向上
2. **メンテナンスコストの削減**: 重複するコードベースの削除
3. **機能開発の加速**: リソースを新機能開発に集中
4. **エコシステムの活用**: Reactエコシステムの豊富なツールとライブラリを活用

## 影響範囲の分析

### 削除対象

#### アプリケーション
- `/apps/whiteboard/` - Vanilla JS版アプリケーション全体
- `/apps/e2e/` - Vanilla JS版専用のE2Eテスト

#### ドキュメント・設定
- Vanilla JS版に関するドキュメント
- Vanilla JS版専用のビルド設定

### 修正対象

#### モノレポ設定
- `turbo.json` - Vanilla JS版のタスク定義を削除
- ルートの`package.json` - Vanilla JS版関連のスクリプトを削除

#### パッケージ
- 各パッケージのReact依存性を見直し
- React専用の最適化を実施

#### ドキュメント
- `README.md` - プロジェクト説明をReact版のみに更新
- APIドキュメント - React版の使用例に統一

### 維持対象

#### コアパッケージ
すべてのコアパッケージは維持（ヘッドレス設計のため）:
- `@usketch/canvas-core`
- `@usketch/drawing-tools`
- `@usketch/store`
- `@usketch/shared-types`
- `@usketch/shared-utils`
- `@usketch/ui-components`

## 移行計画

### フェーズ1: 準備（1週間）

1. **現状の機能差分分析**
   - Vanilla JS版とReact版の機能差分を洗い出し
   - React版に不足している機能をリストアップ

2. **E2Eテストの統合**
   - `/apps/e2e/`のテストケースを`/apps/e2e-react/`に統合
   - 共通テストケースの抽出と再利用

3. **ドキュメント整備**
   - 移行に関する告知文書の作成
   - React版の使用方法に関するドキュメント強化

### フェーズ2: 機能パリティの達成（2週間）

1. **不足機能の実装**
   - Vanilla JS版のみに存在する機能をReact版に実装
   - パフォーマンス最適化

2. **テストカバレッジの向上**
   - React版のテストカバレッジを90%以上に
   - 統合されたE2Eテストの実行確認

### フェーズ3: 移行実施（1週間）

1. **コードベースのクリーンアップ**
   ```bash
   # Vanilla JS版の削除
   rm -rf apps/whiteboard
   rm -rf apps/e2e
   ```

2. **設定ファイルの更新**
   - `turbo.json`からVanilla JS版の設定を削除
   - CI/CDパイプラインの更新

3. **パッケージ名の変更**
   - `@usketch/app-react` → `@usketch/app`
   - `e2e-react` → `e2e`

4. **ドキュメントの更新**
   - すべてのドキュメントをReact版に統一
   - サンプルコードの更新

### フェーズ4: 最適化（2週間）

1. **React専用の最適化**
   - React.memoの活用
   - useMemoとuseCallbackの最適化
   - React DevToolsプロファイリング

2. **バンドルサイズの最適化**
   - Tree shakingの改善
   - Code splittingの実装

3. **パフォーマンステスト**
   - レンダリングパフォーマンスの測定
   - メモリ使用量の最適化

## 移行チェックリスト

### 削除
- [ ] `/apps/whiteboard/`ディレクトリ
- [ ] `/apps/e2e/`ディレクトリ
- [ ] Vanilla JS版のビルドスクリプト
- [ ] Vanilla JS版のデプロイ設定

### 更新
- [ ] `README.md`のプロジェクト説明
- [ ] `turbo.json`のタスク定義
- [ ] CI/CDワークフロー
- [ ] パッケージ名とディレクトリ名

### 新規作成
- [ ] React版の詳細な使用ガイド
- [ ] 移行ガイド（既存ユーザー向け）
- [ ] React版のベストプラクティスドキュメント

## リスクと対策

### リスク1: 既存ユーザーへの影響
**対策**: 
- 事前の告知（最低1ヶ月前）
- 移行ガイドの提供
- 一定期間のVanilla JS版のアーカイブ提供

### リスク2: パフォーマンスの低下
**対策**:
- 徹底的なパフォーマンステスト
- React専用の最適化技術の活用
- 必要に応じてWeb Workerの活用

### リスク3: 機能の欠落
**対策**:
- 詳細な機能比較テスト
- E2Eテストによる機能保証
- ユーザーフィードバックの収集

## 成功指標

1. **パフォーマンス**: React版がVanilla JS版と同等以上のパフォーマンス
2. **バンドルサイズ**: 20%以内の増加に抑える
3. **開発速度**: 新機能開発速度が30%向上
4. **メンテナンス**: バグ修正時間が50%削減

## タイムライン

```
Week 1: フェーズ1 - 準備
Week 2-3: フェーズ2 - 機能パリティ達成
Week 4: フェーズ3 - 移行実施
Week 5-6: フェーズ4 - 最適化
Week 7: リリースと監視
```

## 結論

React版への完全移行により、開発効率の大幅な向上とメンテナンスコストの削減が期待できます。ヘッドレス設計により、コアロジックはそのまま活用できるため、移行リスクは最小限に抑えられます。

計画的な移行により、ユーザーへの影響を最小限に抑えながら、より良い開発体験とプロダクト品質を実現します。